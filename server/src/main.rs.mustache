#[macro_use]
extern crate log;

mod logger;

#[tokio::main(flavor = "multi_thread", worker_threads = 10)]
async fn main() {
    dotenv::dotenv().ok();

    logger::create();

    if cfg!(feature = "{{#repository}}{{package_name}}{{/repository}}_lib") {
        {{#repository}}{{package_name}}{{/repository}}::db::Repo::create().await;
    }

    if cfg!(feature = "{{#redis}}{{package_name}}{{/redis}}_lib") {
        {{#redis}}{{package_name}}{{/redis}}::connection::RedisConnection::create().await;
    }

    if cfg!(feature = "{{#search}}{{package_name}}{{/search}}_lib") {
        {{#search}}{{package_name}}{{/search}}::meilisearch::MeiliSearch::create().await;
    }

    if cfg!(feature = "{{#warp_api}}{{package_name}}{{/warp_api}}_lib") {
        {{#warp_api}}{{package_name}}{{/warp_api}}::start().await;
    } else {
        {{#axum_api}}{{package_name}}{{/axum_api}}::start().await;
    }
}
